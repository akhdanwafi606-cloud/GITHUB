<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NxzKOPI Pro - Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary: #a30a24;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --bg: #f8f9fa;
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background-color: var(--bg); display: flex; height: 100vh; overflow: hidden; }

        /* --- LOGIN PAGE --- */
        #loginPage {
            position: fixed; inset: 0; background: var(--secondary);
            display: flex; justify-content: center; align-items: center; z-index: 9999;
        }
        .login-card {
            background: white; padding: 40px; border-radius: 20px; width: 350px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .login-card input {
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px;
        }

        /* --- MAIN LAYOUT --- */
        .sidebar { width: 100px; background: var(--secondary); display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
        .nav-item { color: #fff; font-size: 0.7rem; cursor: pointer; padding: 15px 0; width: 100%; text-align: center; opacity: 0.6; transition: 0.3s; }
        .nav-item:hover { opacity: 1; background: rgba(255,255,255,0.1); }
        .nav-item.active { opacity: 1; border-right: 4px solid var(--primary); background: rgba(255,255,255,0.1); }

        .main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .content-area { flex: 1; display: flex; overflow: hidden; }
        
        /* POS & GRID */
        .pos-section { flex: 1; padding: 20px; overflow-y: auto; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .product-card { background: white; border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; border: 1px solid #eee; position: relative; transition: 0.2s; }
        .product-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .product-card.out-of-stock { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
        .stock-tag { position: absolute; top: 5px; right: 8px; font-size: 0.6rem; color: #888; }

        /* CART PANEL */
        .cart-panel { width: 350px; background: white; border-left: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; }
        .cart-list { flex: 1; overflow-y: auto; margin: 15px 0; border-top: 1px solid #eee; }
        .cart-item { display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 10px; padding-bottom: 5px; border-bottom: 1px solid #fafafa; }

        /* ADMIN SECTION */
        #adminSection { display: none; padding: 30px; overflow-y: auto; width: 100%; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.8rem; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }

        /* MODAL */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .receipt { background: white; width: 300px; padding: 20px; font-family: monospace; font-size: 0.8rem; }
        
        .btn { border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-bottom: 5px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        @media print { .no-print { display: none; } body { background: white; } }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="login-card">
        <h2 style="color:var(--primary)">NxzKOPI</h2>
        <p style="font-size:0.8rem; color:#666;">Silahkan Masuk ke Sistem</p>
        <input type="text" id="username" placeholder="Username (admin)">
        <input type="password" id="password" placeholder="Password (1234)">
        <button class="btn btn-primary" onclick="handleLogin()">LOGIN</button>
        
        <div style="margin: 15px 0; font-size: 0.7rem; color: #999;">ATAU</div>
        
        <div id="g_id_onload"
             data-client_id="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com"
             data-callback="handleGoogleLogin">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
    </div>
</div>

<div class="sidebar no-print">
    <div style="font-weight:bold; color:white; margin-bottom:30px; font-size:1.2rem;">NK.</div>
    <div class="nav-item active" onclick="switchTab('pos', this)">üõí POS</div>
    <div class="nav-item" onclick="switchTab('admin', this)">‚öôÔ∏è ADMIN</div>
    <div class="nav-item" onclick="location.reload()" style="margin-top:auto">üö™ KELUAR</div>
</div>

<div class="main-container">
    <div id="posSection" class="content-area">
        <div class="pos-section">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h3 style="margin:0;">Terminal Kasir <span id="userDisplayName" style="font-size: 0.8rem; font-weight: normal; color: #888;"></span></h3>
                <input type="text" placeholder="Cari menu..." onkeyup="renderProducts(this.value)" style="padding:8px 15px; border-radius:20px; border:1px solid #ddd;">
            </div>
            <div class="product-grid" id="productGrid"></div>
        </div>

        <div class="cart-panel no-print">
            <h4 style="margin:0;">Rincian Pesanan</h4>
            <div class="cart-list" id="cartList"></div>
            
            <div style="background: #fff9e6; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                <small>Punya Kode Promo?</small>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <input type="text" id="promoCode" placeholder="Kode..." style="flex:1; border:1px solid #ddd; border-radius:5px; padding:5px;">
                    <button class="btn-success" onclick="applyPromo()" style="padding:5px 10px; border:none; border-radius:5px; cursor:pointer;">Cek</button>
                </div>
            </div>

            <div style="font-size:0.85rem; border-top: 2px dashed #eee; padding-top:10px;">
                <div style="display:flex; justify-content:space-between;"><span>Subtotal</span><span id="subTotal">Rp 0</span></div>
                <div style="display:flex; justify-content:space-between; color: var(--success); display:none;" id="diskonRow">
                    <span>Diskon</span><span id="diskonAmount">-Rp 0</span>
                </div>
                <div style="display:flex; justify-content:space-between;"><span>Pajak (10%)</span><span id="tax">Rp 0</span></div>
                <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.1rem; color:var(--primary); margin-top:5px;">
                    <span>TOTAL</span><span id="grandTotal">Rp 0</span>
                </div>
            </div>

            <select id="method" style="width:100%; padding:10px; margin:10px 0; border-radius:8px;">
                <option value="Tunai">üíµ Tunai</option>
                <option value="QRIS">üì± QRIS</option>
                <option value="Debit">üí≥ Kartu Debit</option>
            </select>
            <input type="number" id="cashInput" placeholder="Jumlah Bayar..." style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; margin-bottom:10px;">
            
            <button class="btn btn-warning" onclick="holdOrder()">üì• SIMPAN ANTREAN</button>
            <button class="btn btn-primary" onclick="processPayment()">PROSES BAYAR</button>
            
            <div id="pendingCount" style="text-align:center; font-size:0.7rem; color:var(--warning); margin-top:5px; font-weight:bold;"></div>
        </div>
    </div>

    <div id="adminSection">
        <div style="display:flex; gap:30px;">
            <div style="flex:1; background:white; padding:20px; border-radius:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                <h4>Tambah Menu Baru</h4>
                <div class="form-group">
                    <label>Nama Menu</label>
                    <input type="text" id="newName">
                </div>
                <div class="form-group">
                    <label>Harga (Rp)</label>
                    <input type="number" id="newPrice">
                </div>
                <div class="form-group">
                    <label>Stok Awal</label>
                    <input type="number" id="newStock">
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="newCat">
                        <option value="COFFEE">COFFEE</option>
                        <option value="NON-COFFEE">NON-COFFEE</option>
                        <option value="BREAD">BREAD</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="addNewProduct()">SIMPAN MENU</button>
            </div>
            
            <div style="flex:2; background:white; padding:20px; border-radius:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                <h4>Statistik Penjualan</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div style="background:var(--bg); padding:15px; border-radius:10px;">
                        <small>Total Omzet</small>
                        <h2 id="statIncome" style="margin:0; color:var(--success)">Rp 0</h2>
                    </div>
                    <div style="background:var(--bg); padding:15px; border-radius:10px;">
                        <small>Total Transaksi</small>
                        <h2 id="statOrders" style="margin:0;">0</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="receipt" id="receiptArea"></div>
</div>

<script>
    // Database Produk
    let products = [
       // --- COFFEE SERIES ---
        { id: 1, name: "Aren Signature", price: 18000, stock: 42, icon: "ü•§" },
        { id: 2, name: "Caramel Latte", price: 24000, stock: 15, icon: "üçÆ" },
        { id: 3, name: "Americano Ice", price: 15000, stock: 88, icon: "‚òï" },
        { id: 4, name: "Vanilla Latte", price: 23000, stock: 12, icon: "üç¶" },
        { id: 5, name: "Hazelnut Coffee", price: 24000, stock: 9, icon: "ü•ú" },
        { id: 6, name: "Spanish Latte", price: 26000, stock: 21, icon: "üá™üá∏" },
        { id: 7, name: "Mocha Melt", price: 25000, stock: 7, icon: "üç´" },
        { id: 8, name: "Affogato", price: 22000, stock: 14, icon: "üç®" },
        { id: 9, name: "Cold Brew Ori", price: 20000, stock: 5, icon: "üßä" },
        { id: 10, name: "Espresso Double", price: 12000, stock: 99, icon: "‚òï" },

        // --- NON-COFFEE SERIES ---
        { id: 11, name: "Matcha Latte", price: 26000, stock: 18, icon: "üçµ" },
        { id: 12, name: "Nxz Chocolate", price: 22000, stock: 33, icon: "üç´" },
        { id: 13, name: "Red Velvet", price: 25000, stock: 11, icon: "üç∞" },
        { id: 14, name: "Taro Velvet", price: 24000, stock: 16, icon: "üç†" },
        { id: 15, name: "Klepon Latte", price: 27000, stock: 8, icon: "üü¢" },
        { id: 16, name: "Cookies & Cream", price: 28000, stock: 20, icon: "üç™" },
        { id: 17, name: "Cotton Candy", price: 25000, stock: 13, icon: "üç≠" },
        { id: 18, name: "Strawberry Milk", price: 22000, stock: 19, icon: "üçì" },

        // --- PREMIUM TEA ---
        { id: 19, name: "Earl Grey Tea", price: 18000, stock: 45, icon: "üçÉ" },
        { id: 20, name: "Peach Tea Ice", price: 20000, stock: 24, icon: "üçë" },
        { id: 21, name: "Lychee Tea", price: 20000, stock: 31, icon: "üçí" },
        { id: 22, name: "Lemon Tea", price: 15000, stock: 50, icon: "üçã" },
        { id: 23, name: "Chamomile Hot", price: 18000, stock: 12, icon: "üåº" },
        { id: 24, name: "Thai Tea Ori", price: 15000, stock: 40, icon: "üçÇ" },

        // --- ARTISAN PASTRY ---
        { id: 25, name: "Croissant Ori", price: 15000, stock: 6, icon: "ü•ê" },
        { id: 26, name: "Pain Au Choc", price: 18000, stock: 4, icon: "ü•ñ" },
        { id: 27, name: "Cheese Danish", price: 20000, stock: 3, icon: "üßÄ" },
        { id: 28, name: "Almond Croissant", price: 22000, stock: 2, icon: "ü•®" },
        { id: 29, name: "Cinnamon Roll", price: 18000, stock: 10, icon: "üåÄ" },
        { id: 30, name: "Beef Puff", price: 21000, stock: 7, icon: "ü•ß" },

        // --- HEAVY MEALS / SNACKS ---
        { id: 31, name: "Nxz Platter", price: 35000, stock: 15, icon: "üçü" },
        { id: 32, name: "Chicken Wings", price: 28000, stock: 12, icon: "üçó" },
        { id: 33, name: "French Fries", price: 18000, stock: 40, icon: "üçü" },
        { id: 34, name: "Sandwich Beef", price: 25000, stock: 5, icon: "ü•™" },
        { id: 35, name: "Waffle Ice Cream", price: 30000, stock: 9, icon: "üßá" },

        // --- REFRESHER (SODA base) ---
        { id: 36, name: "Blue Lagoon", price: 24000, stock: 22, icon: "üåä" },
        { id: 37, name: "Virgin Mojito", price: 24000, stock: 18, icon: "üçÉ" },
        { id: 38, name: "Berry Punch", price: 26000, stock: 14, icon: "üçπ" },
        { id: 39, name: "Sunrise Soda", price: 24000, stock: 20, icon: "üåÖ" },
        { id: 40, name: "Nxz Boba Milk", price: 24000, stock: 0, icon: "üßã" } // Stok Habis
    ];

    let cart = [];
    let pendingOrders = [];
    let history = { income: 0, orders: 0 };
    let discount = 0;

    // --- FITUR LOGIN ---
    function handleLogin() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(u === 'Akhdan20' && p === '200507') {
            successLogin("Admin");
        } else {
            alert("Login Gagal!");
        }
    }

    function handleGoogleLogin(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        successLogin(payload.name);
    }

    function successLogin(name) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('userDisplayName').innerText = `| Kasir: ${name}`;
    }

    // --- FITUR POS ---
    function switchTab(tab, el) {
        document.getElementById('posSection').style.display = tab === 'pos' ? 'flex' : 'none';
        document.getElementById('adminSection').style.display = tab === 'admin' ? 'block' : 'none';
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    function renderProducts(query = "") {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase())).map(p => `
            <div class="product-card ${p.stock <= 0 ? 'out-of-stock' : ''}" onclick="addToCart(${p.id})">
                <span class="stock-tag">Stok: ${p.stock}</span>
                <div style="font-size:2.5rem">${p.icon}</div>
                <div style="font-weight:bold; font-size:0.8rem; margin:5px 0;">${p.name}</div>
                <div style="color:var(--primary); font-size:0.9rem;">Rp ${p.price.toLocaleString()}</div>
                ${p.stock <= 0 ? '<div style="color:red; font-size:0.6rem; font-weight:bold;">HABIS</div>' : ''}
            </div>
        `).join('');
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        if(p.stock <= 0) return alert("Stok Habis!");
        const inCart = cart.find(c => c.id === id);
        if(inCart) inCart.qty++; else cart.push({...p, qty:1});
        updateUI();
    }

    function updateUI() {
        const list = document.getElementById('cartList');
        let sub = 0;
        list.innerHTML = cart.map(c => {
            sub += c.price * c.qty;
            return `<div class="cart-item"><span>${c.name} x${c.qty}</span><span>Rp ${(c.price*c.qty).toLocaleString()}</span></div>`;
        }).join('');
        
        const discValue = sub * discount;
        const tax = (sub - discValue) * 0.1;
        
        if(discValue > 0) {
            document.getElementById('diskonRow').style.display = 'flex';
            document.getElementById('diskonAmount').innerText = `-Rp ${discValue.toLocaleString()}`;
        } else {
            document.getElementById('diskonRow').style.display = 'none';
        }

        document.getElementById('subTotal').innerText = `Rp ${sub.toLocaleString()}`;
        document.getElementById('tax').innerText = `Rp ${tax.toLocaleString()}`;
        document.getElementById('grandTotal').innerText = `Rp ${(sub - discValue + tax).toLocaleString()}`;
    }

    // --- FITUR BARU: PROMO & HOLD ---
    function applyPromo() {
        const code = document.getElementById('promoCode').value.toUpperCase();
        if(code === "KOPIASIK") {
            discount = 0.2; // 20%
            alert("Promo Berhasil! Diskon 20% diterapkan.");
        } else {
            discount = 0;
            alert("Kode tidak valid.");
        }
        updateUI();
    }

    function holdOrder() {
        if(cart.length === 0) return alert("Keranjang kosong!");
        pendingOrders.push([...cart]);
        cart = [];
        updateUI();
        document.getElementById('pendingCount').innerText = `${pendingOrders.length} Pesanan dalam antrean`;
        alert("Pesanan disimpan! Anda bisa melayani pelanggan berikutnya.");
    }

    function processPayment() {
        if(cart.length === 0) return alert("Keranjang kosong!");
        const total = parseInt(document.getElementById('grandTotal').innerText.replace(/\D/g,''));
        const cash = parseInt(document.getElementById('cashInput').value) || 0;
        const method = document.getElementById('method').value;

        if(method === 'Tunai' && cash < total) return alert("Uang kurang!");

        history.income += total;
        history.orders++;
        cart.forEach(c => products.find(p => p.id === c.id).stock -= c.qty);

        const change = cash - total;
        document.getElementById('receiptArea').innerHTML = `
            <h3 style="text-align:center; margin:0;">NxzKOPI</h3>
            <p style="text-align:center; font-size:0.6rem; margin-bottom:10px;">Jl. Kode Premium No. 123</p>
            <hr>
            ${cart.map(c => `<div>${c.name} x${c.qty} <span style="float:right">Rp ${(c.price*c.qty).toLocaleString()}</span></div>`).join('')}
            <hr>
            <div>TOTAL: <span style="float:right">Rp ${total.toLocaleString()}</span></div>
            <div>BAYAR (${method}): <span style="float:right">Rp ${cash.toLocaleString()}</span></div>
            <div style="font-weight:bold">KEMBALI: <span style="float:right">Rp ${change.toLocaleString()}</span></div>
            <hr>
            <p style="text-align:center">Terima Kasih!</p>
            <button class="btn btn-primary no-print" onclick="window.print()">CETAK</button>
            <button class="btn btn-success no-print" style="margin-top:5px" onclick="resetAll()">PESANAN BARU</button>
        `;
        document.getElementById('modal').style.display = 'flex';
        updateStats();
    }

    function addNewProduct() {
        const name = document.getElementById('newName').value;
        const price = parseInt(document.getElementById('newPrice').value);
        const stock = parseInt(document.getElementById('newStock').value);
        if(!name || !price) return alert("Isi data menu!");
        
        products.push({ id: Date.now(), name, price, stock, icon: "üè∑Ô∏è" });
        alert("Menu Berhasil Ditambah!");
        renderProducts();
    }

    function updateStats() {
        document.getElementById('statIncome').innerText = `Rp ${history.income.toLocaleString()}`;
        document.getElementById('statOrders').innerText = history.orders;
    }

    function resetAll() {
        cart = [];
        discount = 0;
        document.getElementById('promoCode').value = '';
        document.getElementById('modal').style.display = 'none';
        document.getElementById('cashInput').value = '';
        renderProducts();
        updateUI();
    }

    renderProducts();
</script>

</body>
</html>
